(()=>{var j=Object.defineProperty;var G=(s,r,t)=>r in s?j(s,r,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[r]=t;var x=(s,r,t)=>(G(s,typeof r!="symbol"?r+"":r,t),t),D=(s,r,t)=>{if(!r.has(s))throw TypeError("Cannot "+t)};var i=(s,r,t)=>(D(s,r,"read from private field"),t?t.call(s):r.get(s)),h=(s,r,t)=>{if(r.has(s))throw TypeError("Cannot add the same private member more than once");r instanceof WeakSet?r.add(s):r.set(s,t)},v=(s,r,t,e)=>(D(s,r,"write to private field"),e?e.call(s,t):r.set(s,t),t);var d=(s,r,t)=>(D(s,r,"access private method"),t);var p,m,M=class extends Set{constructor(t,e){super();h(this,p,null);h(this,m,null);v(this,p,t),v(this,m,e)}add(t){super.add(t);let e=i(this,m);if(e)try{e.add(t)}catch{e.add(`--${t}`)}else i(this,p).setAttribute(`state-${t}`,"")}delete(t){super.delete(t);let e=i(this,m);e?(e.delete(t),e.delete(`--${t}`)):i(this,p).removeAttribute(`state-${t}`)}has(t){return super.has(t)}clear(){for(let t of this)this.delete(t)}};p=new WeakMap,m=new WeakMap;var P=()=>new Promise(s=>setTimeout(s,0)),I=new CSSStyleSheet;I.replace(`
  :host {
    display: contents;
  }
`);var R=class extends Event{constructor(t){super("loadstart",{});x(this,"request",null);this.request=t}},C=class extends Event{constructor(t,e,n){super(t,n);x(this,"content",null);this.content=e}};function F(s){let r=s.type==="click"?s.target.closest("a[target]"):s.target,t=s.target.ownerDocument.head.querySelector("base[target]"),e=r&&r.target?document.getElementById(r.target):t&&t.target?document.getElementById(t.target):null;!e||!(e instanceof S)||(s.type==="submit"&&r.tagName==="FORM"?(e.src=s.submitter.getAttribute("formaction")||r.action,s.preventDefault()):s.type==="click"&&r.tagName==="A"&&(e.src=r.href,s.preventDefault()))}var y=/^text\/([^+]+\+)?html\s*(?:;.*)?$/,E=/^image\/(svg\+)xml\s*(?:;.*)?$/,A=/^application\/([^+]+\+)?xml\s*(?:;.*)?$/,U=/^text\/([^+]+\+)?event-stream\s*(?:;.*)?$/,T=/^\*\/(?:[^+]+\+)?\*\s*(?:;.*)?$/,o,l,f,g,b,$,N,k,z,w,O,L=class L extends HTMLElement{constructor(){super();h(this,g);h(this,$);h(this,k);h(this,w);h(this,o,this.attachInternals());h(this,l,new AbortController);h(this,f,new IntersectionObserver(t=>{for(let e of t)if(e.isIntersecting){let{target:n}=e;if(i(this,f).unobserve(n),!(n instanceof L))return;n.loading==="lazy"&&d(this,g,b).call(this)}},{rootMargin:"0px 0px 256px 0px",threshold:.01}));Object.defineProperty(i(this,o),"states",{value:new M(this,i(this,o).states)}),this.shadowRoot||(this.attachShadow({mode:"open"}),this.shadowRoot.adoptedStyleSheets.push(I),this.shadowRoot.append(document.createElement("slot"))),i(this,o).states.add("waiting"),i(this,o).role="presentation"}get src(){return new URL(this.getAttribute("src")||"",window.location.href).toString()}set src(t){this.setAttribute("src",t)}get target(){let t=this.getAttribute("target")||"body";try{return this.matches(t),t}catch{return"body"}}set target(t){this.setAttribute("target",t)}get insert(){let t=this.getAttribute("insert");return t==="append"?"append":t==="prepend"?"prepend":"replace"}set insert(t){this.setAttribute("insert",t)}get loading(){return this.getAttribute("loading")==="lazy"?"lazy":this.getAttribute("loading")==="none"?"none":"eager"}set loading(t){this.setAttribute("loading",t)}get accept(){let t=this.getAttribute("accept")||"";return y.test(t)||E.test(t)||A.test(t)||T.test(t)?t:"text/html"}set accept(t){this.setAttribute("accept",t)}attributeChangedCallback(t,e,n){t==="src"||t==="accept"?this.isConnected&&this.loading==="eager"?d(this,g,b).call(this):this.loading!=="eager"&&i(this,l).call(this).abort():t==="loading"&&this.isConnected&&e!=="eager"&&n==="eager"&&d(this,g,b).call(this)}connectedCallback(){this.src&&this.loading==="eager"&&d(this,g,b).call(this),i(this,f).observe(this),this.ownerDocument.addEventListener("click",F,!0),this.ownerDocument.addEventListener("submit",F,!0)}disconnectedCallback(){i(this,f).unobserve(this),i(this,l).abort("disconnected")}};o=new WeakMap,l=new WeakMap,f=new WeakMap,g=new WeakSet,b=async function(){if(!this.hasAttribute("src")||!i(this,l).signal.aborted&&i(this,l).src==this.src)return;i(this,l).abort(),v(this,l,new AbortController),i(this,l).src=this.src,i(this,o).states.delete("error"),i(this,o).states.delete("waiting"),i(this,o).states.add("loading"),await P();let t=!1;try{let e=new R(new Request(this.src,{method:"GET",credentials:"same-origin",headers:{Accept:this.accept}}));U.test(this.accept)?await d(this,$,N).call(this,e.request):await d(this,k,z).call(this,e.request)}catch(e){t=e}finally{if(i(this,l).abort(),await P(),i(this,o).states.delete("loading"),i(this,o).states.delete("streaming"),i(this,o).states.add(t?"error":"loaded"),this.dispatchEvent(new Event(t?"error":"load")),this.dispatchEvent(new Event("loadend")),t)throw t}},$=new WeakSet,N=async function(t){let e=new EventSource(t.src);i(this,l).signal.addEventListener("abort",()=>{e.close()});let n=!1;e.addEventListener("message",a=>{n&&d(this,w,O).call(this,message.data,"text/html")}),await new Promise((a,c)=>{e.addEventListener("open",a,{once:!0}),e.addEventListener("error",c,{once:!0})}),n=!0,this.dispatchEvent(new Event("open")),i(this,o).states.delete("loading"),i(this,o).states.add("streaming"),await new Promise((a,c)=>{e.addEventListener("close",a,{once:!0}),e.addEventListener("error",c,{once:!0})})},k=new WeakSet,z=async function(t){let e=i(this,l).signal,n;try{n=await fetch(t,{signal:e})}catch(u){if(u.code==DOMException.ABORT_ERR)return;throw u}if(!n)throw new Error("Failed to load response");let a=n.headers.get("Content-Type")||"",c=this.accept;if(!T.test(c)){let u=(a.match(y)||a.match(A)||a.match(E)||[])[1],B=(c.match(y)||c.match(A)||c.match(E)||[])[1];if(u&&u!==B)throw new Error(`Failed to load resource: expected ${c} but was ${a}`)}let q=y.test(a)?"text/html":A.test(a)?"application/xml":E.test(a)?"image/svg+xml":null;if(!q)throw new Error(`Failed to load resource: expected mime to be like 'text/html', 'application/xml' or 'image/svg+xml', but got ${a||"(empty string)"}`);d(this,w,O).call(this,await n.text(),q)},w=new WeakSet,O=function(t,e){let a=new DOMParser().parseFromString(t,e).querySelector(this.target).childNodes,c=new C("beforeinsert",a,{cancelable:!0});if(!this.dispatchEvent(c))return;let u=this.ownerDocument.activeElement;u.blur(),this.insert==="append"?this.append(...c.content):this.insert==="prepend"?this.prepend(...c.content):this.replaceChildren(...c.content),u.focus(),this.dispatchEvent(new C("inserted",this.childNodes))},x(L,"observedAttributes",["src","accept","loading"]);var S=L;customElements.define("i-html",S);})();
